{
  "type": "structure-preparation",
  "label": "Structure Preparation",
  "category": "analysis",
  "icon": "structure-icon",
  "color": "blue",
  "description": "Clean/repair PDBs, add missing atoms/residues, standardize formats and protonation to produce analysis-ready receptor and peptide structures.",
  "pricing": {
    "credits": 1200,
    "executionTime": 5
  },
  "outputMockLabel": "Result",
  "defaultInputs": [
    {
      "id": "receptor_source",
      "name": "Receptor Source",
      "type": "structure",
      "required": true,
      "tooltip": "PDB file, AlphaFold model, or experimental structure for the receptor. Can be a filepath or accession ID."
    },
    {
      "id": "ligand_peptide_source",
      "name": "Ligand/Peptide Source",
      "type": "structure",
      "required": true,
      "tooltip": "PDB file or amino acid sequence string for the ligand peptide."
    }
  ],
  "defaultOutputs": [
    {
      "id": "ligand_clean",
      "name": "",
      "type": "structure",
      "tooltip": "Cleaned and prepared ligand structure (PDB format)."
    }
  ],
  "configSchema": [
    {
      "key": "receptorSourceType",
      "type": "select",
      "label": "Receptor Source Type",
      "options": [
        { "value": "pdb_file", "label": "PDB file" },
        { "value": "alphafold", "label": "AlphaFold model" },
        { "value": "experimental", "label": "Experimental structure" }
      ],
      "defaultValue": "pdb_file",
      "tooltip": "Type of receptor source: upload PDB file, use AlphaFold prediction, or fetch experimental structure."
    },
    {
      "key": "receptorPdbFile",
      "type": [
        "text",
        "file"
      ],
      "label": "PDB File",
      "suggestedField": ["pdb_1"],
      "accept": ".pdb",
      "tooltip": "PDB file containing protein names and sequences.",
      "showWhen": [
        {
          "field": "receptorSourceType",
          "in": [
            "pdb_file"
          ]
        }
      ]
    },
    {
      "key": "receptorPdbFileChoice",
      "type": "select",
      "label": "choose PDB file",
      "options": [
        { "value": "9now", "label": "9NOW" },
        { "value": "9nor", "label": "9NOR" },
        { "value": "9nos", "label": "9NOS" }
      ],
      "defaultValue": "9now",
      "tooltip": "Select the type of PDB file you want to use.",
      "showWhen": [
        {
          "field": "receptorPdbFile",
          "in": [
            "*"
          ]
        }
      ]
    },
    {
      "key": "receptorAlphaFoldId",
      "type": "textarea",
      "label": "AlphaFold ID",
      "placeholder": "e.g., AF-A1B2C3D4-F1-model_v4",
      "tooltip": "AlphaFold ID for the receptor.",
      "showWhen": [
        {
          "field": "receptorSourceType",
          "in": [
            "alphafold"
          ]
        }
      ]
    },
    {
      "key": "receptorExperimentalId",
      "type": "text",
      "label": "Experimental ID",
      "placeholder": "e.g., 1A2B",
      "tooltip": "Experimental ID for the receptor.",
      "showWhen": [
        {
          "field": "receptorSourceType",
          "in": [
            "experimental"
          ]
        }
      ]
    },
    {
      "key": "desiredPH",
      "type": "number",
      "label": "Desired pH",
      "defaultValue": 7.4,
      "placeholder": "7.4",
      "tooltip": "Target pH for protonation state prediction (e.g., 7.4 for physiological conditions)."
    },
    {
      "key": "preparationTool",
      "type": "select",
      "label": "Preparation Tool",
      "options": [
        { "value": "pdbfixer", "label": "PDBFixer" },
        { "value": "foldx", "label": "FoldX RepairPDB" },
        { "value": "pdb-tools", "label": "pdb-tools" },
        { "value": "biopython", "label": "BioPython" },
        { "value": "modeller", "label": "MODELLER" }
      ],
      "defaultValue": "pdbfixer",
      "tooltip": "Tool to use for structure preparation. PDBFixer is recommended for most cases."
    },
    {
      "key": "fixMissingResidues",
      "type": "boolean",
      "label": "Fix Missing Residues",
      "defaultValue": true,
      "tooltip": "Attempt to model and add missing residues in the structure."
    },
    {
      "key": "addHydrogens",
      "type": "boolean",
      "label": "Add Hydrogens",
      "defaultValue": true,
      "tooltip": "Add hydrogen atoms to the structure based on pH-dependent protonation states."
    },
    {
      "key": "forcefield",
      "type": "select",
      "label": "Force Field",
      "options": [
        { "value": "amber99sb-ildn", "label": "AMBER99SB-ILDN" },
        { "value": "amber14-all", "label": "AMBER14-all" },
        { "value": "charmm36", "label": "CHARMM36" },
        { "value": "opls-aa", "label": "OPLS-AA" }
      ],
      "defaultValue": "amber99sb-ildn",
      "tooltip": "Force field to use for parameterization and hydrogen placement."
    },
    {
      "key": "repairMode",
      "type": "select",
      "label": "Repair Mode",
      "options": [
        { "value": "minimal", "label": "Minimal – only fix critical issues" },
        { "value": "aggressive", "label": "Aggressive – fix all detected problems" }
      ],
      "defaultValue": "minimal",
      "tooltip": "Minimal: only fix critical issues. Aggressive: attempt to fix all detected problems."
    },
    {
      "key": "mutations",
      "type": "textarea",
      "label": "Mutations (Optional)",
      "placeholder": "e.g., A123G, B456F",
      "tooltip": "Optional list of mutations to apply, in format: ChainResidueNewAA (e.g., A123G means chain A, residue 123, mutate to Glycine)."
    },
    {
      "key": "removeChains",
      "type": "text",
      "label": "Remove Chains (Optional)",
      "placeholder": "e.g., C, D",
      "tooltip": "Optional list of chain IDs to remove from the structure."
    },
    {
      "key": "findPocketRegion",
      "type": "boolean",
      "label": "Finding the pocket region?",
      "defaultValue": true,
      "tooltip": "Whether to detect and analyze binding pocket regions in the predicted structure."
    },
    {
      "key": "pocketModel",
      "type": "select",
      "label": "Choose model to predict pocket",
      "options": [
        {
          "value": "fpocket",
          "label": "fpocket"
        },
        {
          "value": "sitemap",
          "label": "SiteMap"
        },
        {
          "value": "deepsite",
          "label": "DeepSite"
        },
        {
          "value": "p2rank",
          "label": "P2Rank"
        }
      ],
      "defaultValue": "fpocket",
      "tooltip": "Select the pocket prediction model. fpocket is fast and open-source, SiteMap provides detailed druggability analysis.",
      "showWhen": [
        {
          "field": "findPocketRegion",
          "in": [
            "true"
          ]
        }
      ]
    }
  ],
  "defaultConfig": {
    "receptorSourceType": "pdb_file",
    "ligandSourceType": "pdb_file",
    "desiredPH": 7.4,
    "preparationTool": "pdbfixer",
    "fixMissingResidues": true,
    "addHydrogens": true,
    "forcefield": "amber99sb-ildn",
    "repairMode": "minimal",
    "mutations": "",
    "removeChains": ""
  },
  "feedsTo": ["docking", "electrostatics", "surface-mapping"]
}
